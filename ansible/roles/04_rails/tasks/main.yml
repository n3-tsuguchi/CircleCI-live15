---
- name: Check if rails is installed
  shell: bash -lc "gem list -e rails | grep {{ rails_version }}"
  register: check_rails_installed
  changed_when: no
  ignore_errors: yes
  environment:
    RBENV_ROOT: /usr/local/rbenv
    PATH: "/usr/local/rbenv/bin:/usr/local/rbenv/shims:{{ ansible_env.PATH }}"

- name: Install rails
  shell: bash -lc "gem install rails -v {{ rails_version }}"
  when: check_rails_installed is failed
  environment:
    RBENV_ROOT: /usr/local/rbenv
    PATH: "/usr/local/rbenv/bin:/usr/local/rbenv/shims:{{ ansible_env.PATH }}"
